jQuery(function(e){var t=e("#woocommerce-order-items"),o=!1,i={handle_events:function(){t.on("click","button.configure_composite",{action:"configure"},this.clicked_edit_button).on("click","button.edit_composite",{action:"edit"},this.clicked_edit_button)},clicked_edit_button:function(t){var c=e.WCBackboneModal.View.extend({addButton:i.clicked_done_button}),n=e(this).closest("tr.item").attr("data-order_item_id");return o=new c({target:"wc-modal-edit-composite",string:{action:"configure"===t.data.action?wc_composite_admin_order_params.i18n_configure:wc_composite_admin_order_params.i18n_edit,item_id:n}}),i.populate_form(),!1},clicked_done_button:function(c){i.block(o.$el.find(".wc-backbone-modal-content"));var n=e.extend({},i.get_taxable_address(),{action:"woocommerce_edit_composite_in_order",item_id:o._string.item_id,fields:o.$el.find("input, select, textarea").serialize(),dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_composite_admin_order_params.edit_composite_nonce});e.post(woocommerce_admin_meta_boxes.ajax_url,n,function(e){e.result&&"success"===e.result?(t.find(".inside").empty(),t.find(".inside").append(e.html),"yes"===wc_composite_admin_order_params.is_wc_version_gte_3_4?t.trigger("wc_order_items_reloaded"):(i.core.init_tiptip(),i.core.stupidtable.init()),i.unblock(o.$el.find(".wc-backbone-modal-content")),i.block(t,{fadeIn:0}),setTimeout(function(){i.unblock(t)},250),o.closeButton(c)):(window.alert(e.error?e.error:wc_composite_admin_order_params.i18n_validation_error),i.unblock(o.$el.find(".wc-backbone-modal-content")))})},populate_form:function(){i.block(o.$el.find(".wc-backbone-modal-content"));var t={action:"woocommerce_configure_composite_order_item",item_id:o._string.item_id,dataType:"json",order_id:woocommerce_admin_meta_boxes.post_id,security:wc_composite_admin_order_params.edit_composite_nonce};e.post(woocommerce_admin_meta_boxes.ajax_url,t,function(t){t.result&&"success"===t.result?(o.$el.find("form").html(t.html),e(document.body).trigger("wc-enhanced-select-init"),o.$el.find(".composite_component").each(function(){new c(e(this))}),i.unblock(o.$el.find(".wc-backbone-modal-content"))):(window.alert(wc_composite_admin_order_params.i18n_form_error),i.unblock(o.$el.find(".wc-backbone-modal-content")),o.$el.find(".modal-close").trigger("click"))})},get_taxable_address:function(){var t="",o="",i="",c="";return"shipping"===woocommerce_admin_meta_boxes.tax_based_on&&(t=e("#_shipping_country").val(),o=e("#_shipping_state").val(),i=e("#_shipping_postcode").val(),c=e("#_shipping_city").val()),"billing"!==woocommerce_admin_meta_boxes.tax_based_on&&t||(t=e("#_billing_country").val(),o=e("#_billing_state").val(),i=e("#_billing_postcode").val(),c=e("#_billing_city").val()),{country:t,state:o,postcode:i,city:c}},block:function(t,o){var i={message:null,overlayCSS:{background:"#fff",opacity:.6}},c=e.extend({},i,o||{});t.block(c)},unblock:function(e){e.unblock()}};"no"===wc_composite_admin_order_params.is_wc_version_gte_3_4&&(i.core={init_tiptip:function(){e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),e(".tips").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200})},stupidtable:{init:function(){e(".woocommerce_order_items").stupidtable(),e(".woocommerce_order_items").on("aftertablesort",this.add_arrows)},add_arrows:function(t,o){var i=e(this).find("th"),c="asc"===o.direction?"&uarr;":"&darr;",n=o.column;i.find(".wc-arrow").remove(),i.eq(n).append('<span class="wc-arrow">'+c+"</span>")}}}),i.handle_events();var c=function(t){var o=this;this.$selection_el=t.find("select.component_option_select"),this.$view_el=t.find(".component_option_selection_details_wrapper"),this.component_id=t.data("component_data").component_id,this.composite_id=t.data("component_data").composite_id;var c=Backbone.Model.extend({selected_product_data:{product_html:""},initialize:function(){this.set({selected_product:o.$selection_el.val()})},update_selection:function(e){e?this.load_selection_data(e):this.update_selected_product("",{product_html:""})},load_selection_data:function(t){var i=this,c={action:"woocommerce_get_composited_product_data",product_id:t,component_id:o.component_id,composite_id:o.composite_id};e.ajax({type:"POST",url:woocommerce_admin_meta_boxes.ajax_url,data:c,timeout:15e3,dataType:"json",success:function(e){if("success"===e.result){var o=e.product_data;i.trigger("selected_product_data_loaded",t,o),i.update_selected_product(t,o)}else i.trigger("selected_product_data_load_error",t)},error:function(){i.trigger("selected_product_data_load_error",t)}})},update_selected_product:function(e,t){this.selected_product_data=t,this.set({selected_product:e})},get_selected_product_data:function(){return this.selected_product_data}}),n=Backbone.View.extend({initialize:function(){this.listenTo(this.model,"change:selected_product",this.render),this.listenTo(this.model,"selected_product_data_load_error",this.selection_data_load_error),o.$selection_el.on("change",this.selection_changed)},selection_changed:function(){var t=e(this).val()||"";if(o.selection_model.get("selected_product")===t)return!1;t?(o.selection_view.block(),o.selection_model.update_selection(t)):o.selection_model.update_selection("")},render:function(){o.$view_el.html(this.model.get_selected_product_data().product_html),this.model.get("selected_product")&&this.unblock()},selection_data_load_error:function(){var e=this.model.get("selected_product");window.alert(wc_composite_admin_order_params.i18n_selection_request_timeout),o.$selection_el.val(e).change(),this.unblock()},block:function(){i.block(o.$view_el)},unblock:function(){i.unblock(o.$view_el)}});this.selection_model=new c,this.selection_view=new n({el:o.$view_el,model:o.selection_model})}});