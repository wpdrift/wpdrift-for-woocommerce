jQuery(function(t){function e(e){var n=this;this.$el=e,this.$content=e.find(".bto_group_data"),this.$metabox_title=e.find("h3 .group_name"),this.$section_links=this.$content.find(".subsubsub a"),this.$sections=this.$content.find(".tab_group"),this.$discount=this.$content.find(".group_discount"),this.$filters=this.$content.find(".group_filters"),this.$display_prices=this.$content.find(".component_display_prices"),this.$pagination_style=this.$content.find(".component_pagination_style"),this.$query_type_containers=this.$content.find(".component_query_type_selector"),this.$query_type_selector=this.$content.find("select.component_query_type"),this.$options_style_selector=this.$content.find("select.options_style_selector"),this.$categories_selector=this.$content.find("select.categories_selector"),this.$products_selector=this.$content.find("select.products_selector"),this.$default_selectors_container=this.$content.find(".default_selector_container"),this.$default_selectors=this.$content.find(".default_selector_wrapper"),this.$default_selector_categories=this.$content.find("select.default_selector_categories"),this.$default_selector_products=this.$content.find("select.default_selector_products"),this.$optional_checkbox=this.$content.find("input.component_optional"),this.$title_input=this.$content.find("input.group_title"),this.$priced_individually_input=this.$content.find(".group_priced_individually input"),this.$show_filters_input=this.$content.find(".group_show_filters input"),this.initialized_content=!1,this.component_toggled=function(){var t=n.maybe_initialize_content()?50:10,e=this.$el,o=this.$content;setTimeout(function(){e.toggleClass("closed").toggleClass("open"),o.stop().slideToggle()},t)},this.maybe_initialize_content=function(){var t=!1;return n.initialized_content||(t=!0,n.initialize_content()),t},this.section_changed=function(t){n.$section_links.removeClass("current"),t.addClass("current"),n.$sections.addClass("tab_group_hidden"),n.$content.find(".tab_group_"+t.data("tab")).removeClass("tab_group_hidden")},this.title_changed=function(){n.$metabox_title.text(n.$title_input.val()),o(!0)},this.query_type_changed=function(){n.$query_type_containers.hide(),n.$default_selectors.hide();var t=n.$query_type_selector.val();n.$content.find(".component_query_type_"+t).show(),this.initialized_content&&("category_ids"===t?(n.reinitialize_default_option_category_select(),n.maybe_update_default_option_category_ids(!0)):(n.initialize_default_option_product_select(),n.default_option_changed()),o(!0))},this.products_changed=function(){n.initialize_default_option_product_select(),n.default_option_changed(),o(!0)},this.categories_changed=function(){var t=n.get_category_ids();n.$default_selector_categories.data("include",t.join()),n.maybe_update_default_option_category_ids(!0),o(!0)},this.optional_changed=function(){n.default_option_changed(),o(!0)},this.options_style_changed=function(){"yes"===n.$options_style_selector.find('option[value="'+n.$options_style_selector.val()+'"]').data("supports").pagination?n.$pagination_style.show():n.$pagination_style.hide()},this.priced_individually_input_changed=function(){n.$priced_individually_input.is(":checked")?(n.$discount.show(),n.$display_prices.show()):(n.$discount.hide(),n.$display_prices.hide())},this.show_filters_input_changed=function(){n.$show_filters_input.is(":checked")?n.$filters.show():n.$filters.hide()},this.default_option_changed=function(){var t=n.$query_type_selector.val(),e=n.get_default_option(),o=n.get_default_option_html(),i="category_ids"===t?n.$default_selector_categories.val():n.$default_selector_products.val(),a=!0,c=!1;if(!i&&!n.is_optional())if("category_ids"===t)"defaults"===m.val()&&n.get_category_ids().length>0&&(c="set_defaults");else{var s=n.get_product_ids().length;s>0&&("defaults"===m.val()?c="set_defaults":1===s&&(c="set_defaults_static"))}c&&(n.has_error(n.$default_selectors_container)||(setTimeout(function(){n.add_error_tip(n.$default_selectors_container,c)},5),e||n.add_error(n.$default_selectors_container,c)),"product_ids"===t?n.$default_selector_products.val(e).triggerHandler("change"):o&&n.$default_selector_categories.append(o).val(e).triggerHandler("change"),a=!1),a&&(n.clear_error(n.$default_selectors_container),n.set_default_option(i))},this.add_error_tip=function(e,o){var n=e.position();0===e.parent().find(".wc_error_tip").length&&(e.after('<div class="wc_error_tip">'+wc_composite_admin_params["i18n_"+o]+"</div>"),e.parent().find(".wc_error_tip").css("left",n.left+e.width()-e.width()/2-t(".wc_error_tip").width()/2).css("top",n.top+e.height()).fadeIn("100"))},this.has_error=function(t){return t.hasClass("selection_error")},this.add_error=function(t,e){t.find(".wc-cp-error-tip").attr("data-tip",wc_composite_admin_params["i18n_"+e]),t.find(".wc-cp-error-tip").tipTip(I),t.addClass("selection_error")},this.clear_error=function(t){t.removeClass("selection_error")},this.initialize=function(){n.query_type_changed(),n.options_style_changed(),n.priced_individually_input_changed(),n.show_filters_input_changed()},this.initialize_default_option_category_select=function(){void 0===n.get_default_option_html()&&n.save_default_option_html()},this.reinitialize_default_option_category_select=function(){var t=n.get_default_option(),e=n.get_default_option_html();e&&n.$default_selector_categories.append(e),n.$default_selector_categories.val(t).triggerHandler("change")},this.initialize_default_option_product_select=function(){var t=n.$products_selector.find(":selected").clone().removeAttr("selected"),e=n.get_default_option()&&t.filter('[value="'+n.get_default_option()+'"]').length>0;if(n.$default_selector_products.find("option").remove(),n.$default_selector_products.append(t),!e){var o=!n.is_optional()&&t.length>0&&("defaults"===m.val()||1===t.length)?t.first().val():0;n.set_default_option(o)}n.$default_selector_products.val(n.get_default_option()).triggerHandler("change")},this.initialize_content=function(){"category_ids"===n.$query_type_selector.val()?n.initialize_default_option_category_select():n.initialize_default_option_product_select(),n.initialize_select2s(),n.initialized_content=!0},this.initialize_select2s=function(){var t=n.$content.find(".wc-product-search-lazy"),e=n.$content.find(".wc-enhanced-select-lazy");t.addClass("wc-product-search"),e.addClass("wc-enhanced-select"),n.$content.wc_cp_select2(),t.removeClass("wc-product-search"),e.removeClass("wc-enhanced-select")},this.maybe_update_default_option_category_ids=function(e){if(e=e||!1,null===n.get_default_option_category_ids()){n.update_default_option_category_ids_xhr&&n.update_default_option_category_ids_xhr.abort();var o={action:"woocommerce_get_product_categories",product_id:n.get_default_option(),security:wc_composite_admin_params.get_product_categories_nonce};n.update_default_option_category_ids_xhr=t.post(woocommerce_admin_meta_boxes.ajax_url,o,function(t){n.set_default_option_category_ids("success"===t.result?t.category_ids:[]),e&&n.check_default_option_in_category_ids()})}else e&&n.check_default_option_in_category_ids()},this.check_default_option_in_category_ids=function(){(n.get_default_option()&&!n.is_default_option_in_category_ids()||0===n.get_category_ids().length)&&(n.set_default_option(0),n.$default_selector_categories.val(0).trigger("change"))},this.is_default_option_in_category_ids=function(){var e=n.get_selector_data(n.$categories_selector),o=n.get_default_option_category_ids(),i=[];t.each(e,function(t,e){i.push(parseInt(e.id))});var a=!1;return t.each(o,function(t,e){if(n.array_contains(parseInt(e),i))return a=!0,!1}),a},this.get_default_option_category_ids=function(){return this.$default_selectors_container.data("selected_data").default_option_category_ids},this.set_default_option_category_ids=function(t){this.$default_selectors_container.data("selected_data").default_option_category_ids=t},this.get_default_option_html=function(){return this.$default_selectors_container.data("selected_data").default_option_html},this.save_default_option_html=function(){var t=this.$default_selectors_container.data("selected_data");if(n.get_default_option()){var e="category_ids"===n.$query_type_selector.val()?n.$default_selector_categories.find(":selected").clone():n.$default_selector_products.find(":selected").clone();t.default_option_html=e}else t.default_option_html=!1},this.get_default_option=function(){return this.$default_selectors_container.data("selected_data").default_option_id||0},this.set_default_option=function(t){var e=this.$default_selectors_container.data("selected_data");e.default_option_id=t||0,n.save_default_option_html(),n.set_default_option_category_ids(!!e.default_option_id&&null),n.maybe_update_default_option_category_ids()},this.get_selector_data=function(t){return"yes"===wc_composite_admin_params.is_wc_version_gte_3_2?t.selectWoo("data"):t.select2("data")},this.get_category_ids=function(){var e=n.get_selector_data(n.$categories_selector),o=[];return t.each(e,function(t,e){o.push(parseInt(e.id))}),o},this.get_product_ids=function(){var e=n.get_selector_data(n.$products_selector),o=[];return t.each(e,function(t,e){o.push(parseInt(e.id))}),o},this.array_contains=function(e,o){return-1!==t.inArray(e,o)},this.is_optional=function(){return n.$optional_checkbox.is(":checked")},this.initialize()}function o(t){H=t=!!t}function n(){w.length>0?(v.removeClass("no-components"),g.removeClass("disabled")):(v.addClass("no-components"),g.addClass("disabled"))}function i(){v.on("click",".expand_all",function(){return!t(this).hasClass("disabled")&&(t.each($,function(t,e){e.initialize_content(),setTimeout(function(){e.$el.addClass("open").removeClass("closed"),e.$content.show()},50)}),!1)}).on("click",".close_all",function(){return!t(this).hasClass("disabled")&&(t.each($,function(t,e){setTimeout(function(){e.$el.addClass("closed").removeClass("open"),e.$content.hide()},10)}),!1)}).on("click",".bto_group_handle",function(){var e=t(this).closest(".bto_group").data("component_metabox_id"),o=$[e];void 0!==o&&o.component_toggled()}).on("click",".subsubsub a",function(e){var o=t(this),n=t(this).closest(".bto_group").data("component_metabox_id");$[n].section_changed(o),e.preventDefault()}).on("click","a.remove_row",function(e){var o=t(this).closest(".bto_group"),n=o.data("component_metabox_id");o.find("*").off(),o.remove(),delete $[n],f.triggerHandler("wc-cp-components-changed"),e.preventDefault()}).on("click","button.add_bto_group",function(){f.block(D),y++;var o={action:"woocommerce_add_composite_component",post_id:woocommerce_admin_meta_boxes.post_id,id:y,security:wc_composite_admin_params.add_component_nonce};return setTimeout(function(){t.post(woocommerce_admin_meta_boxes.ajax_url,o,function(o){b.append(o);var n=t(".bto_group",b).last(),i=new e(n),a="component_"+y;n.data("component_metabox_id",a),$[a]=i,f.triggerHandler("wc-cp-components-changed"),i.initialize_content(),n.find(".woocommerce-help-tip").tipTip(I),f.triggerHandler("wc-cp-component-added",[i]),f.unblock()})},250),!1}).on("keyup","input.group_title",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].title_changed()}).on("change","select.component_query_type",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].query_type_changed()}).on("change","select.categories_selector",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].categories_changed()}).on("change","select.products_selector",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].products_changed()}).on("change","select.default_selector_categories",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].default_option_changed()}).on("change","select.default_selector_products",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].default_option_changed()}).on("change","input.component_optional",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].optional_changed()}).on("change","select.options_style_selector",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].options_style_changed()}).on("change",".group_priced_individually input",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].priced_individually_input_changed()}).on("change",".group_show_filters input",function(){var e=t(this).closest(".bto_group").data("component_metabox_id");$[e].show_filters_input_changed()}).on("click",".upload_component_image_button",function(e){S.$button=t(this),e.preventDefault(),S.image_frame?S.image_frame.open():(S.image_frame=wp.media({title:wc_composite_admin_params.i18n_choose_component_image,button:{text:wc_composite_admin_params.i18n_set_component_image},states:[new wp.media.controller.Library({title:wc_composite_admin_params.i18n_choose_component_image,filterable:"all"})]}),S.image_frame.on("select",function(){var t=S.image_frame.state().get("selection").first().toJSON(),e=t.sizes&&t.sizes.thumbnail?t.sizes.thumbnail.url:t.url;S.$button.addClass("has_image"),S.$button.closest(".component_image").find(".remove_component_image_button").addClass("has_image"),S.$button.find("input").val(t.id).change(),S.$button.find("img").eq(0).attr("src",e)}),S.image_frame.open())}).on("click",".remove_component_image_button",function(e){var o=t(this),n=o.closest(".component_image"),i=n.find(".upload_component_image_button");e.preventDefault(),i.removeClass("has_image"),o.removeClass("has_image"),n.find("input").val("").change(),i.find("img").eq(0).attr("src",wc_composite_admin_params.wc_placeholder_img_src)})}function a(){b.sortable({items:".bto_group",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),f.triggerHandler("wc-cp-components-changed")}}),n()}function c(){$={},w.each(function(o){var n=t(this),i="component_"+o;n.data("component_metabox_id",i),$[i]=new e(n)}),a()}function s(t){var e=this;this.$el=t,this.$content=t.find(".bto_scenario_data"),this.$metabox_title=t.find("h3 .scenario_name"),this.$title_input=this.$content.find("input.scenario_title"),this.$conditional_components_action_input=this.$content.find(".toggle_conditional_components input"),this.$conditional_components_action_config=this.$content.find(".scenario_action_conditional_components_group .action_components"),this.render_content=this.$content.data("scenario_content"),this.initialized_content=!1,this.scenario_toggled=function(){var t=this.$el,o=this.$content;if(!A){var n=e.maybe_initialize_content(),i=n&&_()?200:n?50:10;setTimeout(function(){t.toggleClass("closed").toggleClass("open"),o.stop().slideToggle({always:function(){n&&_()&&(e.$el.removeClass("loading"),A=!1)}})},i)}},this.maybe_initialize_content=function(){var t=!1,o=_()?100:10;return e.initialized_content||(t=!0,_()&&(e.$el.addClass("loading"),A=!0),setTimeout(function(){e.initialize_content()},o)),t},this.title_changed=function(){e.$metabox_title.text(e.$title_input.val())},this.match_component_changed=function(t){t.is(":checked")?t.closest(".bto_scenario_selector").find(".bto_scenario_matching_conditions_wrapper").show():t.closest(".bto_scenario_selector").find(".bto_scenario_matching_conditions_wrapper").hide()},this.conditional_components_action_input_changed=function(){e.$conditional_components_action_input.is(":checked")?e.$conditional_components_action_config.show():e.$conditional_components_action_config.hide()},this.initialize_content=function(){""!==e.render_content&&(e.$content.html(e.render_content),e.$title_input=e.$content.find("input.scenario_title"),e.$conditional_components_action_input=e.$content.find(".toggle_conditional_components input"),e.$conditional_components_action_config=e.$content.find(".scenario_action_conditional_components_group .action_components")),e.initialize_select2s(),e.initialized_content=!0},this.initialize_select2s=function(){var t=e.$content.find(".wc-component-options-search-lazy"),o=e.$content.find(".wc-enhanced-select-lazy");t.addClass("wc-component-options-search"),o.addClass("wc-enhanced-select"),e.$content.wc_cp_select2(),e.$content.wc_cp_select2_component_options(),t.removeClass("wc-component-options-search"),o.removeClass("wc-enhanced-select")},this.initialize=function(){},this.initialize()}function _(){return w.length>20}function r(){T.length>0?C.removeClass("disabled"):C.addClass("disabled")}function l(){k.on("click",".expand_all",function(){return!t(this).hasClass("disabled")&&(t.each(j,function(t,e){e.initialize_content(),setTimeout(function(){e.$el.addClass("open").removeClass("closed"),e.$content.show()},50)}),!1)}).on("click",".close_all",function(){return!t(this).hasClass("disabled")&&(t.each(j,function(t,e){setTimeout(function(){e.$el.addClass("closed").removeClass("open"),e.$content.hide()},10)}),!1)}).on("click",".bto_scenario_handle",function(){var e=t(this).closest(".bto_scenario").data("scenario_metabox_id"),o=j[e];void 0!==o&&o.scenario_toggled()}).on("click","a.remove_row",function(e){var o=t(this).closest(".bto_scenario"),n=o.data("scenario_metabox_id");o.find("*").off(),o.remove(),delete j[n],x.triggerHandler("wc-cp-scenarios-changed"),e.preventDefault()}).on("keyup","input.scenario_title",function(){var e=t(this).closest(".bto_scenario").data("scenario_metabox_id");j[e].title_changed()}).on("change","input.bto_scenario_match_component",function(){var e=t(this).closest(".bto_scenario").data("scenario_metabox_id");j[e].match_component_changed(t(this))}).on("change",".toggle_conditional_components input",function(){var e=t(this).closest(".bto_scenario").data("scenario_metabox_id");j[e].conditional_components_action_input_changed()}).on("click","button.add_bto_scenario",function(){x.block(D),q++;var e={action:"woocommerce_add_composite_scenario",post_id:woocommerce_admin_meta_boxes.post_id,id:q,security:wc_composite_admin_params.add_scenario_nonce};return setTimeout(function(){t.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){z.append(e);var o=t(".bto_scenario",z).last(),n=new s(o),i="scenario_"+q;o.data("scenario_metabox_id",i),j[i]=n,x.triggerHandler("wc-cp-scenarios-changed"),n.initialize_content(),o.find(".tips, .woocommerce-help-tip").tipTip(I),x.triggerHandler("wc-cp-scenario-added",[n]),x.unblock()})},250),!1})}function d(){z.sortable({items:".bto_scenario",cursor:"move",axis:"y",handle:".sort-item",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(t,e){e.item.css("background-color","#f6f6f6")},stop:function(t,e){e.item.removeAttr("style"),x.triggerHandler("wc-cp-scenarios-changed")}}),r()}function p(){j={},T.each(function(e){var o=t(this),n="scenario_"+e;o.data("scenario_metabox_id",n),j[n]=new s(o)}),d()}function u(){f.block(D),x.block(D),w.find("*").off();var e={post_id:woocommerce_admin_meta_boxes.post_id,data:t("#bto_product_data, #bto_scenario_data").find("input, select, textarea").serialize(),action:"woocommerce_bto_composite_save",security:wc_composite_admin_params.save_composite_nonce};setTimeout(function(){R=t.post(woocommerce_admin_meta_boxes.ajax_url,e,function(e){var n=window.location.toString();n=n.replace("post-new.php?","post.php?post="+woocommerce_admin_meta_boxes.post_id+"&action=edit&"),t.get(n,function(n){var i=[],a=[],s=t("#bto_config_group_inner",f),_=t("#bto_scenarios_inner",x),r=t(n).find("#bto_config_group_inner"),l=r.find(".bto_group"),d=t(n).find("#bto_scenarios_inner"),u=d.find(".bto_scenario");w.length===l.length&&w.each(function(){var e=t(this);if(e.hasClass("open")){var o=e.attr("rel");i.push(o)}}),l.each(function(){var e=t(this),o=e.attr("rel");-1!==t.inArray(o,i)?(e.addClass("open").removeClass("closed"),e.find(".wc-metabox-content").show()):e.find(".wc-metabox-content").hide()}),T.length===u.length&&_.find(".bto_scenario").each(function(){var e=t(this);if(e.hasClass("open")){var o=e.attr("rel");a.push(o)}}),u.each(function(){var e=t(this),o=e.attr("rel");-1!==t.inArray(o,a)?(e.addClass("open").removeClass("closed"),e.find(".wc-metabox-content").show()):e.find(".wc-metabox-content").hide()}),w.find("*").off(),T.find("*").off(),s.html(r.html()),_.html(d.html()),g=s.find(".bulk_toggle_wrapper"),C=_.find(".bulk_toggle_wrapper"),f.triggerHandler("wc-cp-components-changed"),c(),x.triggerHandler("wc-cp-scenarios-changed"),p(),t("#bto_product_data .woocommerce-help-tip, #bto_scenario_data .woocommerce-help-tip, #bto_scenario_data .tips").tipTip(I),w.each(function(){var e=t(this);if(e.hasClass("open")){var o=e.data("component_metabox_id");$[o].initialize_content()}}),T.each(function(){var e=t(this);if(e.hasClass("open")){var o=e.data("scenario_metabox_id");j[o].initialize_content()}}),e.length>0&&t.each(e,function(t,e){window.alert(e)}),f.unblock(),x.unblock(),R=!1,o(!1)})},"json")},250)}var h={language:{errorLoading:function(){return wc_composite_admin_params.i18n_searching},inputTooLong:function(t){var e=t.input.length-t.maximum;return 1===e?wc_composite_admin_params.i18n_input_too_long_1:wc_composite_admin_params.i18n_input_too_long_n.replace("%qty%",e)},inputTooShort:function(t){var e=t.minimum-t.input.length;return 1===e?wc_composite_admin_params.i18n_input_too_short_1:wc_composite_admin_params.i18n_input_too_short_n.replace("%qty%",e)},loadingMore:function(){return wc_composite_admin_params.i18n_load_more},maximumSelected:function(t){return 1===t.maximum?wc_composite_admin_params.i18n_selection_too_long_1:wc_composite_admin_params.i18n_selection_too_long_n.replace("%qty%",t.maximum)},noResults:function(){return wc_composite_admin_params.i18n_no_matches},searching:function(){return wc_composite_admin_params.i18n_searching}}};t.fn.wc_cp_select2=function(){t(":input.wc-enhanced-select",this).filter(":not(.enhanced)").each(function(){var e=t(this),o=t.extend({minimumResultsForSearch:10,allowClear:!!e.data("allow_clear"),placeholder:e.data("placeholder"),closeOnSelect:!0,dropdownParent:e.closest("#bto_product_data, #bto_scenario_data")},h);if("yes"===wc_composite_admin_params.is_wc_version_gte_3_2?e.selectWoo(o).addClass("enhanced"):e.select2(o).addClass("enhanced"),e.on("select2:unselecting",function(){e.data("unselecting",!0)}).on("select2:opening",function(t){e.data("unselecting")&&(e.removeData("unselecting"),t.preventDefault())}),e.data("sortable")){var n=e.next(".select2-container").find("ul.select2-selection__rendered");n.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){t(n.find(".select2-selection__choice").get().reverse()).each(function(){var o=t(this).data("data").id,n=e.find('option[value="'+o+'"]')[0];e.prepend(n)})}})}}),t(":input.wc-product-search",this).filter(":not(.enhanced)").each(function(){var e=t(this),o={allowClear:!!e.data("allow_clear"),placeholder:e.data("placeholder"),minimumInputLength:e.data("minimum_input_length")?e.data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",delay:250,data:function(t){return{term:t.term,action:e.data("action")||"woocommerce_json_search_products_and_variations",security:wc_enhanced_select_params.search_products_nonce,exclude:e.data("exclude"),include:e.data("include"),limit:e.data("limit")}},processResults:function(e){var o=[];return e&&t.each(e,function(t,e){o.push({id:t,text:e})}),{results:o}},cache:!0}};if(o=t.extend(o,h),"yes"===wc_composite_admin_params.is_wc_version_gte_3_2?e.selectWoo(o).addClass("enhanced"):e.select2(o).addClass("enhanced"),e.on("select2:unselecting",function(){e.data("unselecting",!0)}).on("select2:opening",function(t){e.data("unselecting")&&(e.removeData("unselecting"),t.preventDefault())}),e.data("sortable")){var n=t(this).next(".select2-container").find("ul.select2-selection__rendered");n.sortable({placeholder:"ui-state-highlight select2-selection__choice",forcePlaceholderSize:!0,items:"li:not(.select2-search__field)",tolerance:"pointer",stop:function(){if(t(n.find(".select2-selection__choice").get().reverse()).each(function(){var o=t(this).data("data").id,n=e.find('option[value="'+o+'"]')[0];e.prepend(n)}),e.hasClass("products_selector")){var o=e.closest(".bto_group").data("component_metabox_id");$[o].products_changed()}}})}else e.prop("multiple")&&e.on("change",function(){var t=e.children();t.sort(function(t,e){var o=t.text.toLowerCase(),n=e.text.toLowerCase();return o>n?1:o<n?-1:0}),e.html(t)})})},t.fn.wc_cp_select2_component_options=function(){t(":input.wc-component-options-search",this).filter(":not(.enhanced)").each(function(){var e=t(this),o=e.data("action"),n={allowClear:!!e.data("allow_clear"),placeholder:e.data("placeholder"),minimumInputLength:e.data("minimum_input_length")?t(this).data("minimum_input_length"):"3",escapeMarkup:function(t){return t},ajax:{url:wc_enhanced_select_params.ajax_url,dataType:"json",quietMillis:250,data:function(t){return{term:t.term,action:o,security:wc_enhanced_select_params.search_products_nonce,exclude:e.data("exclude"),include:e.data("include"),limit:e.data("limit")}},processResults:function(o){var n=[];return"yes"===e.data("component_optional")&&n.push({id:"-1",text:wc_composite_admin_params.i18n_none}),n.push({id:"0",text:wc_composite_admin_params.i18n_all}),o&&t.each(o,function(t,e){n.push({id:t,text:e})}),{results:n}},cache:!0}};n=t.extend(n,h),"yes"===wc_composite_admin_params.is_wc_version_gte_3_2?t(this).selectWoo(n).addClass("enhanced"):t(this).select2(n).addClass("enhanced"),e.on("select2:unselecting",function(){e.data("unselecting",!0)}).on("select2:opening",function(t){e.data("unselecting")&&(e.removeData("unselecting"),t.preventDefault())})})};var f=t("#bto_product_data"),m=f.find("#_bto_shop_price_calc"),g=f.find(".bulk_toggle_wrapper"),v=t(".config_group",f),b=t(".bto_groups",v),w=t(".bto_group",b),y=w.length,$={},x=t("#bto_scenario_data"),C=x.find(".bulk_toggle_wrapper"),k=t(".scenarios_config_group",x),z=t(".bto_scenarios",x),T=t(".bto_scenario",z),q=T.length,j={},H=!1,S={image_frame:!1,$button:!1},D={message:null,overlayCSS:{background:"#fff",opacity:.6}},I={attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200},L=[],A=!1;t.each(wc_composite_admin_params.layouts,function(t,e){L.push("layout-"+e)}),t(".composite_stock_msg").appendTo("._manage_stock_field .description"),t("#_sold_individually").closest(".form-field").addClass("hide_if_composite"),t("#linked_product_data .grouping.show_if_simple, #linked_product_data .form-field.show_if_grouped").addClass("hide_if_composite"),t(".show_if_simple:not(.hide_if_composite)").addClass("show_if_composite"),"undefined"==typeof woocommerce_admin_meta_boxes&&(woocommerce_admin_meta_boxes=woocommerce_writepanel_params),t("body").on("woocommerce-product-type-change",function(e,o){"composite"===o&&(t(".show_if_external").hide(),t(".show_if_composite").show(),t("input#_manage_stock").change())}),t("select#product-type").change(),t("input#_downloadable").change(function(){t("select#product-type").change()}),m.data("val",m.val()),f.off("click").on("click",".bto_layout_label",function(){var e=t(this);e.closest(".bto_layouts").find(".selected").removeClass("selected"),e.addClass("selected"),v.removeClass(L.join(" ")),v.addClass("layout-"+e.find("input").val())}).on("change","#_bto_shop_price_calc",function(){var e=t(this).val(),o=!1;"defaults"===e&&t.each($,function(t,e){if(!e.is_optional()&&!e.get_default_option())return o=!0,window.alert(wc_composite_admin_params.i18n_defaults_unset),m.val(m.data("val")),!1}),o||m.data("val",e)}).one("wc-cp-component-added",function(){v.removeClass("options_group--boarding")}).on("wc-cp-components-changed",function(){b=t(".bto_groups",v),(w=t(".bto_group",b)).each(function(e,o){t(".group_position",o).val(e),t(o).attr("rel",e)}),o(!0),n()}),x.off("click").one("wc-cp-scenario-added",function(){k.removeClass("options_group--boarding")}).on("wc-cp-scenarios-changed",function(){z=t(".bto_scenarios",x),(T=t(".bto_scenario",z)).each(function(e,o){t(".scenario_position",o).val(e),t(o).attr("rel",e)}),r()}),i(),c(),l(),p();var P=t(".cp_scenarios_tab"),M=P.find("a"),R=!1;P.prepend('<a class="cp_scenarios_tab_inner" href="#bto_scenario_data"></a>');var W=P.find("a.cp_scenarios_tab_inner");W.html(M.html()),W.on("click",function(){return H&&!R?window.confirm(wc_composite_admin_params.i18n_scenarios_panel_blocked)&&(M.trigger("click"),setTimeout(function(){u()},150)):M.trigger("click"),!1}),"yes"===wc_composite_admin_params.is_first_composite&&(t("select#product-type").val("composite").change().focus(),setTimeout(function(){t(".composite_product_options a").trigger("click")},500))});